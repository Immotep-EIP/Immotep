datasource db {
    provider = "postgres"
    url      = env("DATABASE_URL")
}

generator db {
    provider = "go run github.com/steebchen/prisma-client-go"
}

enum role {
    owner
    tenant
}

model user {
    id          String   @id @default(cuid())
    email       String   @unique @db.VarChar(255)
    password    String
    firstname   String
    lastname    String
    role        role
    created_at  DateTime @default(now())
    updated_at  DateTime @updatedAt

    owned_properties   property[]
    rented_properties  contract[]
}

model contract {
    tenant      user      @relation(fields: [tenant_id], references: [id])
    tenant_id   String
    property    property  @relation(fields: [property_id], references: [id])
    property_id String

    active      Boolean   @default(true)
    start_date  DateTime
    end_date    DateTime?
    created_at  DateTime  @default(now())

    @@id([tenant_id, property_id])
}

model property {
    id          String   @id @default(cuid())
    name        String
    address     String
    city        String
    postal_code String
    country     String
    area_sqm               Float
    rental_price_per_month Int
    deposit_price          Int
    picture     String?
    created_at  DateTime @default(now())

    owner       user     @relation(fields: [owner_id], references: [id])
    owner_id    String

    contracts          contract[]
    pending_contracts  pendingContract?

    @@unique([name, owner_id])
}

model pendingContract {
    id           String    @id @default(cuid())
    tenant_email String    @unique @db.VarChar(255)

    start_date   DateTime
    end_date     DateTime?
    created_at   DateTime  @default(now())

    property     property  @relation(fields: [property_id], references: [id])
    property_id  String    @unique
}
